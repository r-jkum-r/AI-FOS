UPDATED MASTER PROMPT â€” FULLY OPEN SOURCE ONLY

You are a Senior AI Architect and Full Stack Engineer.

Build a production-ready, fully open-source AI Voice Agent system that
connects Field Officers (FOS) and the IT Team over normal phone calls
using only open-source technologies.

No paid APIs, no proprietary SaaS services allowed.

ğŸ¯ PROBLEM STATEMENT

Many FOS speak only regional languages (Tamil, Telugu, Kannada, Marathi,
Hindi).

The IT Team understands only Hinglish (Hindi + English mix).

The system must act as a real-time bidirectional AI translator + voice
assistant over phone calls.

ğŸ¯ FINAL CALL FLOW

FOS dials company number via PSTN/SIP

FOS speaks in regional language

AI converts speech â†’ Hinglish voice in real time

IT Team hears Hinglish audio

IT Team replies in Hinglish voice

AI converts Hinglish â†’ original regional language voice

FOS hears reply in their own language

âš ï¸ STRICT RULE: Only voice communication, no text UI.

ğŸ¯ CORE REQUIREMENTS

âœ” Works on normal phone numbers (PSTN/SIP) âœ” Real-time bidirectional
voice translation âœ” Auto regional language detection âœ” Streaming
pipeline with <3 sec latency âœ” Fully open-source stack âœ” Horizontally
scalable microservices architecture âœ” Noise-robust audio handling

ğŸ¯ SUPPORTED LANGUAGES

Input (FOS): Tamil, Telugu, Kannada, Marathi, Hindi Output (IT Team):
Hinglish Voice Reply: Hinglish â†’ Original Regional Voice

ğŸ¯ MANDATORY OPEN-SOURCE TECH STACK Telephony Layer

SIP Server: Asterisk

SIP Trunk provider compatible (generic VoIP)

Backend

Framework: FastAPI

Streaming: WebSockets + RTP audio pipeline

Speech Processing

STT: Whisper (self-hosted streaming)

Language Detection: fastText

Translation Engine

Open-source multilingual model (NLLB-200 / MarianMT)

Text-to-Speech

Hinglish Voice: Coqui TTS

Regional Voices: Coqui TTS multilingual models

Queue & State

Redis

Deployment

Containers: Docker

Orchestration: Kubernetes

Monitoring

Metrics: Prometheus

Dashboards: Grafana

ğŸ¯ HIGH-LEVEL ARCHITECTURE

FOS Call (SIP/PSTN) â†“ Asterisk PBX (RTP Stream) â†“ FastAPI Voice Gateway
â†“ Streaming Audio â†’ Whisper STT â†“ Language Detection (fastText) â†“
Open-source Translator (NLLB/MarianMT) â†“ Coqui TTS (Hinglish Voice) â†“
Stream Audio to IT Team SIP Call

(Reverse Flow) IT Team Hinglish Voice â†’ STT â†’ Translation â†’ Regional TTS
â†’ FOS

ğŸ¯ FEATURES TO IMPLEMENT

SIP call handling via Asterisk ARI

Real-time RTP audio streaming pipeline

Regional language auto-detection

Hinglish translation engine (open-source)

Bidirectional voice conversion

Failover if language not detected

Redis-based session state management

Admin dashboard (React) showing active calls

Persistent logs of transcripts

Horizontal scaling via Kubernetes

ğŸ¯ DIRECTORY STRUCTURE /voice-ai-agent â”œâ”€â”€ backend/ â”‚ â”œâ”€â”€ main.py â”‚ â”œâ”€â”€
call_handler.py â”‚ â”œâ”€â”€ translator.py â”‚ â”œâ”€â”€ stt_engine.py â”‚ â”œâ”€â”€
tts_engine.py â”‚ â”œâ”€â”€ language_detector.py â”‚ â””â”€â”€ websocket_stream.py â”œâ”€â”€
asterisk/ â”‚ â”œâ”€â”€ sip.conf â”‚ â”œâ”€â”€ extensions.conf â”‚ â””â”€â”€ ari_handler.py â”œâ”€â”€
infra/ â”‚ â”œâ”€â”€ dockerfile â”‚ â”œâ”€â”€ kubernetes.yaml â”‚ â””â”€â”€ terraform/ â”œâ”€â”€
dashboard/ â”‚ â””â”€â”€ react-admin-panel â””â”€â”€ README.md

ğŸ¯ OUTPUT REQUIRED

Complete architecture diagram

Full FastAPI backend code

Asterisk SIP + ARI integration

Real-time RTP audio streaming implementation

STT â†’ Translation â†’ TTS open-source pipeline

Docker + Kubernetes deployment files

Step-by-step deployment guide

Testing guide with SIP softphones

Scalability & latency optimization strategies

Security best practices (SIP auth, TLS, encryption)

ğŸ¯ CONSTRAINTS

End-to-end latency target: <3 seconds

Must support thousands of concurrent calls

Must auto-scale via Kubernetes

Must handle noisy field audio environments

Must maintain high speech clarity

ğŸ¯ FINAL GOAL

Deliver a fully open-source multilingual AI voice agent enabling:

Regional Language FOS â†” Real-Time AI Translation â†” Hinglish-speaking IT
Team â†” Voice Reply translated back to regional language

No proprietary APIs. No paid services. Fully self-hosted.
